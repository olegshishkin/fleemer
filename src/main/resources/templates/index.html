<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="header::header"></head>
<body>
<div th:replace="navbar::navbar('home')"></div>
    <main role="main" class="container">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h4 class="d-flex justify-content-between align-items-center mb-3">
                        <span class="text-muted" th:text="#{index.total-balance}">Total balance</span>
                        <span class="badge badge-warning badge-pill" th:text="${#numbers.formatDecimal(totalBalance, 1, 2)}">
                            0.00
                        </span>
                    </h4>
                    <ul class="list-group mb-3">
                        <li th:each="a : ${accounts}" class="list-group-item d-flex justify-content-between lh-condensed">
                            <div>
                                <h6 class="my-0" th:text="${a.name}">Name</h6>
                                <small class="text-muted" th:text="${a.type}">Type</small>
                            </div>
                            <span class="text-muted" th:text="${#numbers.formatDecimal(a.balance, 1
                            , 2)}">
                                0.00
                            </span>
                        </li>
                    </ul>
                </div>

                <div class="col-md-8">
                    <div class="d-block my-3 text-center">
                        <div class="custom-control custom-radio custom-control-inline">
                            <input id="outcome" name="operationType" type="radio" class="custom-control-input" required>
                            <label class="custom-control-label" for="outcome" th:text="#{index.form.outcome}">Outcome</label>
                        </div>
                        <div class="custom-control custom-radio custom-control-inline">
                            <input id="income" name="operationType" type="radio" class="custom-control-input" checked required>
                            <label class="custom-control-label" for="income" th:text="#{index.form.income}">Income</label>
                        </div>
                        <div class="custom-control custom-radio custom-control-inline">
                            <input id="transfer" name="operationType" type="radio" class="custom-control-input" required>
                            <label class="custom-control-label" for="transfer" th:text="#{index.form.transfer}">Transfer</label>
                        </div>
                    </div>

                    <form method="post" th:action="@{/operations/create}" action="#" th:object="${operation}"
                          class="needs-validation" novalidate>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <select id="outAccount" th:field="*{outAccount}" class="custom-select d-block w-100">
                                    <option value="" th:text="#{index.form.select-account}"></option>
                                    <option th:each="account : ${accounts}" th:value="${account.id}" th:text="${account.name}"></option>
                                </select>
                                <div th:if="${#fields.hasErrors('outAccount')}">
                                    <span th:errors="*{outAccount}" class="text-danger small"></span><br>
                                </div>
                                <div class="invalid-feedback" th:text="#{index.error.select-value}">Select a value</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <select id="inAccount" th:field="*{inAccount}" class="custom-select d-block w-100" disabled>
                                    <option value="" th:text="#{index.form.select-account}"></option>
                                    <option th:each="account : ${accounts}" th:value="${account.id}" th:text="${account.name}"></option>
                                </select>
                                <div th:if="${#fields.hasErrors('inAccount')}">
                                    <span th:errors="*{inAccount}" class="text-danger small"></span><br>
                                </div>
                                <div class="invalid-feedback" th:text="#{index.error.select-value}">Select a value</div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <select id="category" th:field="*{category}" class="custom-select d-block w-100" title="">
                                    <option id="categoryNameBlankValue" value="" th:text="#{index.form.select-category}"></option>
                                </select>
                                <div class="invalid-feedback" th:text="#{index.error.select-value}">Select a value</div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <input th:field="*{date}" class="form-control" type="text"
                                       placeholder="yyyy-mm-dd" required/>
                                <div th:if="${#fields.hasErrors('date')}">
                                    <span th:errors="*{date}" class="text-danger small"></span><br>
                                </div>
                                <div class="invalid-feedback" th:text="#{index.error.select-date}">Select a date of operation</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <input th:field="*{sum}" type="text" class="form-control"
                                       th:placeholder="#{index.form.sum.placeholder}"
                                       pattern="[0-9]+([\,\.][0-9]+)?" required autofocus/>
                                <div th:if="${#fields.hasErrors('sum')}">
                                    <span th:errors="*{sum}" class="text-danger small"></span><br>
                                </div>
                                <div class="invalid-feedback" th:text="#{index.error.should-be-digit}">
                                    The field cannot be empty and should be a digit
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <textarea th:field="*{comment}" class="form-control" rows="1"
                                          th:placeholder="#{index.form.comment.placeholder}"></textarea>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <button class="btn btn-primary btn-block" type="submit" th:text="#{index.form.submit}">Submit</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12 mb-3"></div>
            </div>

            <div id="chart" class="row"></div>

            <div class="row">
                <div class="col-md-12 mb-5"></div>
            </div>

            <div class="row">
                <div id="operationTable" class="col-md-12 mb-3"></div>
            </div>

            <div class="row">
                <div class="col-md-12 mb-3">
                    <nav>
                        <ul id="pagination" class="pagination justify-content-center"></ul>
                    </nav>
                </div>
            </div>

            <div hidden>
                <table id="operationTableSnippet" class="table table-hover">
                    <thead align="right">
                    <tr>
                        <th scope="col" th:text="#{index.table.date}">Date</th>
                        <th scope="col" th:text="#{index.table.from-account}">From account</th>
                        <th scope="col" th:text="#{index.table.to-account}">To account</th>
                        <th scope="col" th:text="#{index.table.category}">Category</th>
                        <th scope="col" th:text="#{index.table.sum}">Sum</th>
                        <th scope="col"></th>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>

            <div hidden>
                <span id="edit-word" th:text="#{index.table.edit}">Edit</span>
                <span id="delete-word" th:text="#{index.table.delete}">Delete</span>
                <li id="curPage" class="page-item"><a href="#pagination" class="page-link"></a></li>
                <span id="incomeChartText" th:text="#{index.chart.income}">Income</span>
                <span id="outcomeChartText" th:text="#{index.chart.outcome}">Outcome</span>
                <span id="deleteConfirm" th:text="#{index.delete-confirm}">Do you really want to delete this operation?</span>
                <span id="datePickerLang" th:text="#{index.date-picker-lang}">en</span>
            </div>

            <footer th:replace="footer::footer"></footer>
            <script>
                $(document).ready(function(){
                    setValidationListener();
                    setDataPicker();
                    $('#date').val(new Date().toISOString().substring(0, 10));
                    setOperationTypeListener(true);
                    $('#outcome').click();
                    buildChart();
                    getOperationsPage(0, 15);
                });
            </script>
        </div>
    </main>
</body>
</html>